function enablePWImageDialogButtons(){var a=parent.jQuery(".ui-dialog-buttonpane");a.find("button").button("enable");return}function disablePWImageDialogButtons(){var a=parent.jQuery(".ui-dialog-buttonpane");a.find("button").button("disable");return}function closePWImageDialog(){parent.jQuery("iframe.ui-dialog-content").dialog("close")}function setupProcessSaveReloaded(b,a){if(a){var c=parent.jQuery("#"+b).offset().top-20;parent.jQuery("html, body").animate({scrollTop:c},1000,"swing");parent.jQuery("#"+b).hide();setTimeout(function(){parent.jQuery("#"+b).slideDown()},900)}else{parent.jQuery("#"+b).find("img").hide();setTimeout(function(){parent.jQuery("#"+b).find("img").fadeIn("normal",function(){parent.jQuery("#"+b).find(".gridImage__edit").click()})},500)}closePWImageDialog()}function setupProcessSave(e,b,a){var d=false;var c=parent.jQuery("#wrap_Inputfield_"+e);if(!c.length){c=parent.jQuery("#"+b).closest(".Inputfield")}c.trigger("reload");parent.jQuery(".Inputfield").on("reloaded",function(){if(d){return}d=true;if(b.length>0){setTimeout(function(){setupProcessSaveReloaded(b,a)},250)}})}function refreshPageEditField(a){parent.jQuery("#wrap_Inputfield_"+a).trigger("reload")}function setupExecuteVariations(){$(document).on("click","input#delete_all",function(e){if($(this).is(":checked")){$("input.delete").attr("checked","checked")}else{$("input.delete").removeAttr("checked")}e.stopPropagation()});var d={type:"image",closeOnContentClick:true,closeBtnInside:true};$("a.preview").magnificPopup(d);var c=$("#varcnt_id");var a=c.val();var b=c.attr("data-cnt");window.parent.jQuery("#"+a).text(b)}function setupSelectedImage(){var g=false;var d=false;var j=$("#selected_image_settings");var i=$("#selected_image_container");var b=$("#selected_image");var e=$("#selected_image_hidpi");var f;var c=0;var h=0;function a(l){var n=l.width();var w=9999;var x=9999;function v(y){if(y<(f-(f*0.2))){if(!e.is(":visible")){e.closest("label").fadeIn()}e.removeAttr("disabled")}else{e.attr("disabled","disabled");if(e.is(":visible")){e.closest("label").fadeOut()}}}function t(){var z=l.width();var B=l.height();var A=$("#wrap_link_original");if((B>=x||z>=w)&&j.hasClass("croppable")){z=w;B=x;$("#selected_image_link").removeAttr("checked");A.hide()}else{if(!A.is(":visible")){A.fadeIn();if(A.attr("data-was-checked")==1){A.attr("checked","checked")}}}$("#input_width").val(z);$("#input_height").val(B);l.attr("width",z);l.attr("height",B);v(z);var y=$("#latin");if(y.is(":visible")){y.height(B)}if(!j.hasClass("rte")){var C=$("#selected_image_resize");if(n<=z){C.hide()}else{if(!C.is(":visible")){C.fadeIn()}}}}function u(){l.resizable({aspectRatio:true,handles:"n, ne, e, se, s, sw, w",alsoResize:"#selected_image_container",maxWidth:w,maxHeight:x,minWidth:10,minHeight:10,start:function(){j.addClass("resizing_active")},stop:function(){l.attr("width",l.width()).attr("height",l.height());if(n!=l.width()){l.addClass("resized");if(!j.hasClass("rte")){var y=$("#selected_image_resize_yes");if(!y.is(":checked")){y.attr("checked","checked");$("#selected_image_resize_no").removeAttr("checked")}}}j.removeClass("resizing_active");if($("#resize_action").hasClass("on")){$("#resize_action").click().mouseout()}},resize:t});l.addClass("resizable_setup")}var m=null;function r(){var y=[{html:$("#button_crop").html(),click:function(){$("#button_crop").click()}},{html:$("#button_cancel_crop").html(),click:function(){$("#button_cancel_crop").click()},"class":"ui-priority-secondary"}];$(".show_when_crop").hide();$("#crop_action, .crop_trigger").click(function(E){var C=$(this).attr("data-recrop");if(C&&C.length>0){window.location.assign(C);return true}if(!j.hasClass("croppable")){return}if(g){return false}g=true;$("#selected_image_settings").addClass("cropping_active");$(".hide_when_crop").hide();$(".show_when_crop").show();if(l.hasClass("resizable_setup")){l.resizable("destroy")}var B={autoCrop:true,autoCropArea:0.35,zoomable:false,rotatable:false,maxWidth:l.attr("data-origwidth"),maxHeight:l.attr("data-origheight"),minCropBoxWidth:(c<2?0:c),minCropBoxHeight:(h<2?0:h),minWidth:(c<2?0:c),minHeight:(h<2?0:h),done:function(F){$("#crop_x").val(Math.floor(F.x));$("#crop_y").val(Math.floor(F.y));$("#crop_w").val(Math.floor(F.width));$("#crop_h").val(Math.floor(F.height));m=F}};var D=l.attr("data-crop");if(D&&D.length>0){D=D.split(",");B.data={x:D[0],y:D[1],width:D[2],height:D[3]};setTimeout(function(){disablePWImageDialogButtons(y)},1000)}else{disablePWImageDialogButtons(y)}l.cropper(B);setTimeout(function(){$(".cropper-canvas").width($(".cropper-container").width()).height($(".cropper-container").height())},500);var A=function(){var F={x:parseInt($("#crop_x").val()),y:parseInt($("#crop_y").val()),width:parseInt($("#crop_w").val()),height:parseInt($("#crop_h").val()),rotate:0};l.cropper("setData",F)};$("#crop_coordinates input").change(A)});function z(){l.cropper("destroy");$(".show_when_crop").hide();$(".hide_when_crop").show();g=false;$("#selected_image_settings").removeClass("cropping_active");u();enablePWImageDialogButtons()}$("#button_cancel_crop").click(function(){z()});$("#button_crop").click(function(){if(j.hasClass("processing")){return false}j.addClass("processing");return true});if(l.attr("data-crop")){$("#crop_action").click()}}function o(y){if(d){return}if($(this).parents("#crop_coordinates").length){return}d=true;var F,E,C=false,D=false,A=l.attr("width"),G=l.attr("height"),H=parseInt(l.attr("data-origwidth")),I=parseInt(l.attr("data-origheight"));A=typeof A=="undefined"?l.width():parseInt(A);G=typeof G=="undefined"?l.height():parseInt(G);if($(this).attr("id")=="input_width"){F=parseInt($(this).val());E=(I/(H/F));if(F==A){D=true}}else{E=parseInt($(this).val());F=Math.round((E/G)*A);F=(H/(I/E));if(E==G){D=true}}if(F<1||E<1||D){C=1}else{if(w>0&&F>w){C=2}else{if((c>1&&F<c)||(h>1&&E<h)){C=3}}}if(C){$("#input_width").val(A);$("#input_height").val(G);d=false;return false}var B=Math.round(F);var z=Math.round(E);u();$("#input_height").val(z);i.width(F).height(E);l.parent(".ui-wrapper").width(F).height(E);l.width(F).height(E).attr("width",B).attr("height",z).addClass("resized");t();d=false}function p(){var z=l.is(".resized");l.attr("class",$(this).val());i.attr("class",$(this).val());if(z){l.addClass("resized")}var A=i.css("float");var y=$("#latin");if(A=="left"||A=="right"){if(!y.is(":visible")){y.height(i.height());y.fadeIn()}}else{if(y.is(":visible")){y.hide()}}u()}function q(){$("#max_action").click(function(){var z=parseInt(l.attr("data-origwidth"));if(z>w){z=w}if(z>$(window).width()){$("#content").css("overflow-x","auto")}$("#input_width").val(z).change()});$("#min_action").click(function(){var B=l.width();var z=l.height();var C=$(window).width()-30;var D=$(window).height()-$("#wrap_info").height()-60;var A=false;if(z>D){$("#input_height").val(D).change();A=true}if(B>C){$("#input_width").val(C).change();A=true}if(!A){$("#input_width").val(Math.ceil(B/2)).change()}});$("#align_left_action, #align_center_action, #align_right_action").click(function(){var A=$("#selected_image_class");var z=$(this).attr("data-label");if($(this).hasClass("on")){A.children("option").removeAttr("selected");$(this).removeClass("on")}else{$(this).siblings(".on").removeClass("on");A.children("option").removeAttr("selected");A.find("option[data-label="+z+"]").attr("selected","selected");$(this).addClass("on")}A.change()});var y=$("#selected_image_class").find("option[selected=selected]").attr("data-label");if(y){$("#action_icons").find("span[data-label="+y+"]").addClass("on")}$("#resize_action").hover(function(){if($(this).hasClass("on")){return}$("#resize_tips").show();$("#input_width, #input_height").addClass("ui-state-highlight")},function(){if($(this).hasClass("on")){return}$("#resize_tips").hide();$("#input_width, #input_height").removeClass("ui-state-highlight")}).click(function(){if($(this).hasClass("on")){$(this).removeClass("on");$("#input_width, #input_height").removeClass("ui-state-highlight")}else{$(this).addClass("on");$("#input_width, #input_height").addClass("ui-state-highlight")}});$("#description_action").click(function(){if($(this).hasClass("on")){$(this).removeClass("on");$("#wrap_description").slideUp("fast")}else{$(this).addClass("on");$("#wrap_description").slideDown("fast")}})}function k(){$("#selected_image_caption").change(function(){if(j.hasClass("cropping_active")){return}var y=$("#caption_preview");if($(this).is(":checked")){y.fadeIn()}else{if(y.is(":visible")){y.fadeOut()}}}).change()}function s(){var z=$(window).width()-30;var y=$(window).height()-($("#wrap_info").height()+60);if(l.width()>z){l.width(z).css("height","auto").removeAttr("height");l.removeAttr("height")}if(l.height()>y){l.removeAttr("width").css("width","auto").height(y)}i.width(l.width()).height(l.height())}$("#loading_button").hide();if(l.attr("data-fit")){s()}else{i.width(l.width()).height(l.height())}$("#selected_image_settings .input_pixels").change(o);$("#selected_image_class").change(p).change();f=l.attr("data-origwidth");t();r();q();k();$("button.submit_save_copy, button.submit_save_replace").click(function(){j.addClass("processing");disablePWImageDialogButtons()})}if(b.length>0){b=b.first();if(b.width()>0&&b.height()>0){a(b)}else{b.load(function(){b=$(this);a(b)})}}}$(document).ready(function(){var b=$("#page_id");if(b.length>0){var a=b.val();b.bind("pageSelected",function(c,d){if(d.id==a){return}window.location="./?id="+d.id+"&modal=1"})}if($("#selected_image").length>0){setTimeout(function(){setupSelectedImage()},250)}else{if($("#ImageVariations").length>0){setupExecuteVariations()}}enablePWImageDialogButtons();$(window).keydown(function(c){if(c.keyCode==13){c.preventDefault();return false}})});